# 高级检索数据

## 1. 使用子查询

注意：

* 作为子查询的 SELECT 语句只能查询单个列。企图检索多个列将返回错误
* 使用子查询不仅需要考虑能够获得想要的结果，同时也需要考虑不恰当的子查询是否会引起性能问题

### 1.1 条件中的子查询

```
SELECT 单/多列 FROM 表名 WHERE 列 操作符 (SELECT 子句);
```

### 1.2 计算字段中的子查询

```
SELECT 单/多列, (SELECT 子句) FROM 表名 WHERE 条件;
```

??? 难以理解

## 2. 联结表？？？

在一个 SELECT 语句中关联多张表并查询多个表中的数据。

### 2.1 内联结（INNER JOIN）

内连接会忽略条件中列为 NULL 的数据。？？？？？

#### 2.1.1 等值联结

条件中使用相等的条件。

```
SELECT 列名 FROM 表名1, 表名2, ... WHERE =操作符条件;
```

```
SELECT 列名 FROM 表名1 INNER JOIN 表名2, ... ON =操作符联结条件 WHERE 条件;
```

例如：
```
SELECT c.cust_id, o.order_num, o.order_date FROM customers as c, orders as o WHERE c.cust_id = o.cust_id;

SELECT c.cust_id, o.order_num, o.order_date FROM customers as c INNER JOIN orders as o ON c.cust_id = o.cust_id;

SELECT c.cust_id, o.order_num, o.order_date FROM customers as c INNER JOIN orders as o ON c.cust_id = o.cust_id WHERE c.cust_id = '1000000001';
```

#### 2.1.2 不等值联结

```
SELECT 列名 FROM 表名1, 表名2, ... WHERE 非=操作符条件;
```

```
SELECT 列名 FROM 表名1 INNER JOIN 表名2, ... ON 非=操作符联结条件 WHERE 条件;
```

例如：
```
SELECT c.cust_id, o.order_num, o.order_date FROM customers as c, orders as o WHERE c.cust_id != o.cust_id;

SELECT c.cust_id, o.order_num, o.order_date FROM customers as c INNER JOIN orders as o ON c.cust_id != o.cust_id;

SELECT c.cust_id, o.order_num, o.order_datE FROM customers as c INNER JOIN orders as o ON c.cust_id != o.cust_id WHERE c.cust_id = '1000000001';
```

### 2.2 自联结

自身内联自身，特殊的等值联结。适合有自关联的表。

```
SELECT 列名 FROM 表名1 AS b1, 表名1 AS b2, ... WHERE b1与b2之间的条件;
```

```
SELECT 列名 FROM 表名1 AS b1 NNER JOIN 表名1 AS b2, ... ON b1与b2之间的联结条件 WHERE 条件;
```  

### 2.3 自然联结


匹配两个表中具有相同属性，排除被联结表中的重复列。


### 2.4 外联结（OUTER JOIN）

以关联表中的一张表为基础，去匹配其它表，如果匹配不上的行，那么除了基础表中的检索列的数据保持不变，其它检索列均为 NULL。

举例：

* 对每个顾客下的订单进行计数，包括那些至今尚未下单的顾客
* 列出所有产品以及订购数量，包括没有人订购的产品
* 计算平均销售规模，包括那些至今尚未下订单的顾客

#### 2.4.1 左外联结（LEFT OUTER JOIN）

#### 2.4.2 右外联结（RIGHT OUTER JOIN）

#### 2.4.3 全外联结（FULL JOIN 或 FULL OUTER JOIN）

### 2.5 交叉联结/笛卡尔积

## 3. 集合运算查询

主要有两种情况需要使用组合查询：

* 在一个查询中从不同的表返回结构数据
* 对一个表执行多个查询，安一个查询返回数据

### 3.1 UNION（并）

使用规则：

* UNION 必须由两条或两条以上的SELECT 语句组成，语句之间使用关键字 UNION 分隔（因此，如果组合四条 SELECT 语句，将要使用三个 UNION 关键字）
* UNION 中的每个查询必须包含相同的列、表达式或聚集函数（不过各列不需要以相同的次序列出），对于不同的表，可以使用别名来达到一致的效果
* 列数据类型必须兼容：类型不必完全相同，但必须是 DBMS 可以隐含转行的类型（例如：不同的数值类型后不同的日期类型）

注意：

* UNION 从查询结果集中自动取出了重复的行，可以使用 UNION ALL 来取消这一自动操作
* 对使用了 UNION 的结果集排序，只能使用一个ORDER BY，并且必须将 ORDER BY 放在最后一个 SELECT 语句之后

### 3.2 INTERSECT（交）

### 3.3 EXCEPT（差）


















